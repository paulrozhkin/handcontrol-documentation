# API для управления протезом
Для управления протезом используется Bluetooth интерфейс с самописным протоколом и Ethernet интерфейс с протоколом MQTT. Payload для протоколов общий и представляе собой данные в бинарном формате. Дальнейшее описание будет представлять из себя описание API в виде таблицы и общий раздел Payload для представление бинарного формата.

## API
В тиблцев приведено описание API протеза со следующими полями:
* Name - название предоставляемой команды
* MQTT Topic - MQTT топик, который используется для команды
* MQTT Write - может ли кто-либо, кроме протеза (и эмулятора) отправлять сообщения в этот топик
* Bluetooth - идентификатор команды Data link bluetooth протокола, который должнен быть положен в поле id команды
* Payload - идентификатор полезной нагрузки (см. раздел Payload)
* Description - описание команды

|Name|MQTT Topic|MQTT Write|Bluetooth|Payload|Description|
|---|---|---|---|---|---|
|SetOnline|controllers/online|-|X|Online/Offline|Каждый протез отправляет свой id в этот топик каждые 60 секунд для определения того, что он находится в системе и к нему можно получить доступ. Если протез не отправил данные, то можно считать, что он отключен.|
|Offline|controllers/offline|-|X|Online/Offline|При обрыве связи с MQTT Proxy брокер публикует id протеза с которым был обрыв связи (механизм Last Will у MQTT).|
|Telemetry|{id}/telemetry|-|+|Telemetry|При обрыве связи с MQTT Proxy брокер публикует id протеза с которым был обрыв связи (механизм Last Will у MQTT).|
## Payload
### StringFormat
|Field|Size (bytes)|Data Type|Description|
|---|---|---|---|
|Size|4|uint32_t|Количество байт в строке|
|String|Size|UTF-8|Строка UTF-8|

### TypeWorkEnum
|Field|Size (bytes)|Data Type|Description|
|---|---|---|---|
|Size|1|uint8_t|[0x00] - MIO - Миоэлектрический режим работы протеза. В данном режиме выбор исполняемого жеста основывается только на миоэлектрических датчиках; [0x01] - COMMANDS - Режим прямого управления. В данном режиме выбор исполняемого жеста основывается на принимаемых командах с внешнего устройства; [0x02] - AUTO - Стандартный работы протеза. В данном режиме выбор исполняемого жеста основывается как на миоэлектрических датчиках, так и на принимаемых с внешнего устройства командах.|

### DriverTypeWorkEnum
|Field|Size (bytes)|Data Type|Description|
|---|---|---|---|
|Size|1|uint8_t|[0x00] - InitializationMode - Режим инициализации. В данном режиме происходит расчет минимальных и максимальных положений кисти и пальцев протеза; [0x01] - SleepMode - Режим ожидания. Механические действия не исполняются; [0x02] - SettingPositionMode - Режим установки новых положений; [0x03] - ErrorMode - Режим ошибки. Работа невозможна; [0xFF] - ConnectionError - Соединение с контроллером линейных приводов отсутсвует;|

### Online/Offline
|Field|Size (bytes)|Data Type|Description|
|---|---|---|---|
|Id|16|StringFormat|Идентификатор протеза в системе|

### Telemetry
|Field|Size (bytes)|Data Type|Description|
|---|---|---|---|
|TelemetryFrequency|2|uint16_t|Частота отправки телеметрии (от 1Гц до 450Гц)|
|EnableEmg|1|bool|Состояние подключения Emg датчика|
|EnableDisplay|1|bool|Состояние подключения дисплея|
|EnableGyro|1|bool|Состояние подключения гироскопа и акселерометра|
|LastTimeSync|8|long|Время последней синхронизации. В Unix времени|
|TypeWork|1|TypeWorkEnum|Текущий режим работы протеза|
|EMG|2|uint16_t|Показания Emg датчика|
|Gesture|16|UUID|UUID исполняемого жеста. Если значение 0x00, то исполняемого жеста нет. Если значение 0x01, то исполняется жест, который не сохранен на протезе.|
|Power|1|uint8_t|Уровень заряда протеза в процентах (от 0 до 100%)|
|DriverTypeWork|1|DriverTypeWorkEnum|Режим работы контроллера линейных приводов|
|PointerFingerPosition|1|uint8_t|Позиция указательного пальца|
|MiddleFingerPosition|1|uint8_t|Позиция среднего пальца|
|RingFinderPosition|1|uint8_t|Позиция безымянного пальца|
|LittleFingerPosition|1|uint8_t|Позиция мезинца|
|ThumbFingerPosition|1|uint8_t|Позиция большого пальца|
